<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Questionnaire 2</title>
    <style>
        .hidden {
            display: none;
        }
    </style>
    <script>
        function formatTAJ(input) {
            let value = input.value.replace(/\D/g, ''); // Remove all non-digit characters
            if (value.length > 6) {
                value = value.slice(0, 3) + '-' + value.slice(3, 6) + '-' + value.slice(6, 9);
            } else if (value.length > 3) {
                value = value.slice(0, 3) + '-' + value.slice(3, 6);
            }
            input.value = value;
        }

        function toggleRequiredFields(group, required) {
            const inputs = group.querySelectorAll('input[type=radio]');
            inputs.forEach(input => {
                if (required) {
                    input.setAttribute('required', 'required');
                } else {
                    input.removeAttribute('required');
                }
            });
        }

        function toggleDisabledFields(group, disabled) {
            const inputs = group.querySelectorAll('input[type=radio]');
            inputs.forEach(input => {
                input.disabled = disabled;
            });
        }

        function showQuestions() {
            const jawSelection = document.getElementById('jawSelection').value;
            const lowerJawQuestions = document.querySelectorAll('.lower-jaw');
            const upperJawQuestions = document.querySelectorAll('.upper-jaw');

            lowerJawQuestions.forEach(question => {
                question.classList.add('hidden');
                toggleRequiredFields(question, false);
                toggleDisabledFields(question, true);
            });

            upperJawQuestions.forEach(question => {
                question.classList.add('hidden');
                toggleRequiredFields(question, false);
                toggleDisabledFields(question, true);
            });

            if (jawSelection === 'lower') {
                lowerJawQuestions.forEach(question => {
                    question.classList.remove('hidden');
                    toggleRequiredFields(question, true);
                    toggleDisabledFields(question, false);
                });
            } else if (jawSelection === 'upper') {
                upperJawQuestions.forEach(question => {
                    question.classList.remove('hidden');
                    toggleRequiredFields(question, true);
                    toggleDisabledFields(question, false);
                });
            } else if (jawSelection === 'both') {
                lowerJawQuestions.forEach(question => {
                    question.classList.remove('hidden');
                    toggleRequiredFields(question, true);
                    toggleDisabledFields(question, false);
                });
                upperJawQuestions.forEach(question => {
                    question.classList.remove('hidden');
                    toggleRequiredFields(question, true);
                    toggleDisabledFields(question, false);
                });
            }
        }

        function setNullValues() {
            const hiddenInputs = document.querySelectorAll('input[type=hidden]');
            hiddenInputs.forEach(hiddenInput => {
                const groupName = hiddenInput.name.replace('_null', '');
                const radios = document.getElementsByName(groupName);
                let isChecked = false;
                radios.forEach(radio => {
                    if (radio.checked) {
                        isChecked = true;
                    }
                });
                if (!isChecked) {
                    hiddenInput.value = 'NULL';
                }
            });
        }

        function handleSubmit(event) {
            setNullValues();
        }

        document.addEventListener("DOMContentLoaded", function() {
            const form = document.querySelector("form");
            form.addEventListener("submit", handleSubmit);
        });
    </script>
</head>
<body>
    <div class="container">
        <h1>Modellanalízis mérései</h1>
        <div><body>Itt csak azok szerepelnek, amit nem a páciens direkt vizsgálatával állapítunk meg!</body></div>
        <form action="/submit_questionnaire2" method="post" enctype="multipart/form-data">
            <label for="TAJ">TAJ:</label>
            <input type="text" id="TAJ" name="TAJ" pattern="\d{3}-\d{3}-\d{3}" oninput="formatTAJ(this)" maxlength="11" required>
            <label for="jawSelection">Melyik állkapcsot vizsgáljuk?</label>
            <select id="jawSelection" name="jawSelection" onchange="showQuestions()" required>
                <option value="">Válassz...</option>
                <option value="lower">Alsó állkapocs</option>
                <option value="upper">Felső állkapocs</option>
                <option value="both">Mindkettő</option>
            </select>
            
            <table class="upper-jaw hidden">
                <caption style="caption-side: top; text-align: left; text-decoration: underline; font-size: 1.5em;">
                    Klinikai anatómiai képletek a felső állcsonton
                </caption>                
                <thead>
                    <tr>
                        <th>Anatómiai képlet</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>F1 Modellanalízis során mért profil szerint:<br>A felső állcsontgerinc profilja</td>
                        <td>
                            <div>
                                <label for="gerincélvonal">A felső állcsont gerincélvonalának profilja:</label>
                                <input type="hidden" name="F1_null_gerincelvonal" value="">
                                <input type="file" id="gerincelvonal" name="stlFile_gerincelvonal" accept=".stl" required>
                            </div>
                            <div>
                                <label for="bukkalisathajlas">A felső állcsont bukkális áthajlásának profilja:</label>
                                <input type="hidden" name="F1_null_bukkalis" value="">
                                <input type="file" id="bukkalisathajlas" name="stlFile_bukkalis" accept=".stl" required>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td>F2<br>Alámenős területek nagysága a felső állcsonton</td>
                        <td><input type="number" step="0.01" name="F2" placeholder="Enter value"> mm<sup>3</sup></td>
                    </tr>
                </tbody>
            </table>


            <table class="upper-jaw hidden">
                <thead>
                    <tr>
                        <th>Anatómiai képlet</th>
                        <th>Válaszok</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>F3<br>A szájpad boltozata</td>
                        <td><input type="number" step="0.01" name="F3" placeholder="Enter value"> mm</td>
                        </td>
                    </tr>
                    <tr>
                        <td>F4<br>A felső állcsontgerinc alakja</td>
                        <td><input type="number" step="0.01" name="F4" placeholder="Enter value"> &deg;</td>
                        </td>
                    </tr>
            
                    <tr>
                        <td>F6<br>Az interalveoláris vonal és a rágósík által bezárt szög</td>
                        <td><input type="number" step="0.01" name="F6" placeholder="Enter value"> &deg;</td>

                    </tr>
                    
                </tbody>
            </table>
            <table class="lower-jaw hidden">
                <caption style="caption-side: top; text-align: left; text-decoration: underline; font-size: 1.5em;">
                    Klinikai anatómiai képletek az alsó állcsonton
                </caption>        
                <thead>
                    <tr>
                        <th>Anatómiai képlet</th>
                        <th>Válaszok</th>
                    </tr>
                </thead>
                <tbody>
                    
                    <tr>
                        <td>A2 Modellanalízis során mért profil szerint:<br>Az alsó állcsontgerinc profilja</td>
                        <td>
                            <div>
                                <label for="gerincélvonal">A felső állcsont gerincélvonalának profilja:</label>
                                <input type="hidden" name="A1_conti_null_gerincelvonal" value="">
                                <input type="file" id="gerincelvonal" name="stlFile_also_gerincelvonal" accept=".stl" required>
                            </div>
                            <div>
                                <label for="bukkalisathajlas">A felső állcsont bukkális áthajlásának profilja:</label>
                                <input type="hidden" name="A1_conti_null_bukkalis" value="">
                                <input type="file" id="bukkalisathajlas" name="stlFile_also_bukkalis" accept=".stl" required>
                            </div>
                            <div>
                                <label for="lingualisathajlas">A felső állcsont lingualis áthajlásának profilja:</label>
                                <input type="hidden" name="A1_conti_null_lingualis" value="">
                                <input type="file" id="lingualisathajlas" name="stlFile_also_lingualis" accept=".stl" required>
                            </div>
                        </td>
                    </tr>
                </tbody>
            </table>

            


            <table class="lower-jaw hidden">
                <thead>
                    <tr>
                        <th>Globálisan vizsgálandók</th>
                        <th>Válaszok</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>A10<br>Az állcsont-reláció</td>
                        <td><input type="number" step="0.01" name="A10" placeholder="Enter value"> &deg;</td>

                        </td>
                    </tr>
                    
                </tbody>
            </table>

            <input type="submit" value="Submit">
        </form>
    </div>
</body>
</html>
